<!DOCTYPE html>
<html lang="en" xmlns:th="www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Spotify Data</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- Material Design Bootstrap -->
    <link rel="stylesheet" href="css/mdb.min.css">
    <!-- Your custom styles (optional) -->
    <link rel="stylesheet" href="css/style.css">

</head>

<body class="body-bg">
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar">
    
        <div class="container">
            <a class="navbar-brand h1-responsive display-4 heading-main text-white">Spotify Data</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapseNav"
   				 aria-controls="collapseNav" aria-expanded="false" aria-label="Toggle navigation">
    		<span class="navbar-toggler-icon"></span>
  			</button>
  			 <div class="collapse navbar-collapse justify-content-end" id="collapseNav">
            <form class="form-inline pb-0" action="search" method="post">
                <div class="md-form my-0">
                    <input class="form-control mr-sm-2" type="text" placeholder="Search..." name="searchQuery">
                </div>
            </form>
        </div>
    </nav>

    <div class="container container-username">
        <div class="row">
            <h3 class="h3 container-username-heading" th:text="'Hello '+${userName}">Hello Hardik</h3>
        </div>
        <div class="row mt-2 mb-3">
            <a href="/logout" style="margin:auto" type="button" class="btn btn-danger btn-rounded btn-sm">Log Out</a>
        </div>
        <div class="row">
            <div class="accordion md-accordion" id="accordionEx1" role="tablist" aria-multiselectable="true">

                <div class="card" style="background: transparent !important; border-bottom: none !important;">

                    <div class="card-header mb-0 pb-0" role="tab" id="headingTwo1">
                        <a class="collapsed" data-toggle="collapse" data-parent="#accordionEx1" href="#albums" aria-expanded="false" aria-controls="collapseTwo1">
                            <h4 class="mb-0 text-white" style="font-family: anton">
                                Get Your Top Artists
                            </h4>
                        </a>
                    </div>

                    <div id="albums" class="collapse pt-0" role="tabpanel" data-parent="#accordionEx1">
                        <div class="card-body pt-2 pb-0">
                            <div class="container ml-4">
                                <div class="row">
                                    <a class="h5" href="/topArtists?term=2" style="color:#00e676; font-family: anton; text-shadow: 0.7px 0.7px black">All Time</a>
                                </div>
                                <div class="row">
                                    <a class="h5" href="/topArtists?term=1" style="color:#00e676; font-family: anton; text-shadow: 0.7px 0.7px black">From Past 6 Months</a>
                                </div>
                                <div class="row">
                                    <a class="h5" href="/topArtists?term=0" style="color:#00e676; font-family: anton; text-shadow: 0.7px 0.7px black">From Past Month</a>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="accordion md-accordion" id="accordionEx1" role="tablist" aria-multiselectable="true">

                <div class="card" style="background: transparent !important; border-bottom: none !important;">

                    <div class="card-header mb-0 pb-0" role="tab" id="headingTwo1">
                        <a class="collapsed" data-toggle="collapse" data-parent="#tracks" href="#tracks" aria-expanded="false">
                            <h4 class="mb-0 text-white" style="font-family: anton">
                                Get Your Top Tracks
                            </h4>
                        </a>
                    </div>

                    <div id="tracks" class="collapse pt-0" role="tabpanel" data-parent="#accordionEx1">
                        <div class="card-body pt-2 pb-0">
                            <div class="container ml-4">
                                <div class="row">
                                    <a class="h5" href="/topTracks?term=2" style="color:#00e676; font-family: anton; text-shadow: 0.7px 0.7px black">All Time</a>
                                </div>
                                <div class="row">
                                    <a class="h5" href="/topTracks?term=1" style="color:#00e676; font-family: anton; text-shadow: 0.7px 0.7px black">From Past 6 Months</a>
                                </div>
                                <div class="row">
                                    <a class="h5" href="/topTracks?term=0" style="color:#00e676; font-family: anton; text-shadow: 0.7px 0.7px black">From Past Month</a>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="accordion md-accordion" id="accordionEx1" role="tablist" aria-multiselectable="true">

                <div class="card" style="background: transparent !important; border-bottom: none !important;">

                    <div class="card-header mb-0 pb-0" role="tab" id="headingTwo1">
                        <a class="collapsed" data-toggle="collapse" data-parent="#library" href="#library" aria-expanded="false">
                            <h4 class="mb-0 text-white" style="font-family: anton">
                                Your Library
                            </h4>
                        </a>
                    </div>

                    <div id="library" class="collapse pt-0" role="tabpanel" data-parent="#accordionEx1">
                        <div class="card-body pt-2 pb-0">
                            <div class="container ml-4">
                                <div class="row">
                                    <a class="h5" href="/savedAlbums" style="color:#00e676; font-family: anton; text-shadow: 0.7px 0.7px black">Saved Albums</a>
                                </div>
                                <div class="row">
                                    <a class="h5" href="/savedTracks" style="color:#00e676; font-family: anton; text-shadow: 0.7px 0.7px black">Saved Tracks</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="container ml-2 my-2 pt-2">
                <a href="/recentTracks" class="mb-0 text-white h4" style="font-family: anton">
                    Your Recently Played Tracks
                </a>
            </div>
        </div>
        <div class="row">
            <div class="container ml-2 my-2">
                <a href="/newReleases" class="mb-0 text-white h4" style="font-family: anton">
                    New Releases
                </a>
            </div>
        </div>
        <div class="row">
            <div class="container ml-2 my-2">
                <a href="/featuredPlaylists" class="mb-0 text-white h4" style="font-family: anton">
                    Featured Playlists
                </a>
            </div>
        </div>
        <div class="divider-new chili-pepper mt-2">
      		<h4 class="text-center text-uppercase font-weight-bold mx-3 text-white"><a href="https://github.com/hardikSinghBehl/spotifyApiSpring" target="_blank"><i class="fab fa-github text-white"></i></a> Hardik Singh Behl</h4>
    	</div>
    </div>

	<div th:if="${display}">
    <div class="fixed-bottom d-flex flex-column justify-content-center align-items-center">

        <div class="card card-cascade wider reverse player" style="width: 100vw">

            <div class="view view-cascade overlay p-3">
                <div class="song">
                    <p class="font-weight-bold mb-0 text-light" th:text="${#strings.abbreviate(currentPlaying.item.album.name,20)}">Kelis</p>
                    <p class="font-small text-muted mb-0" th:text="${#strings.abbreviate(currentPlaying.item.name+' ('+currentPlaying.item.artists[0].name+')',20)}">Trick me (DJ Flam remix)</p>

                    <div id="mobile-box">

                        <audio id="music" preload="true">
                            <source th:src="@{''+${currentPlaying.item.preview_url}+''}" src="https://bachataurban.com/download/1/Kelis%20-%20Trick%20Me%20(%20DJ%20Flam%20-%20Urban%20Bachata%20remix%20).mp3">
                        </audio>

                        <div id="audioplayer">
                            <div id="timeline">
                                <div id="playhead"></div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
            <div class="card-body card-body-cascade pt-0 pb-3 z-depth-5">

                <div class="row">
                    <div class="col-4 d-flex justify-content-center px-0 mb-1">
                        <img id="image" class="image z-depth-2" th:src="@{''+${currentPlaying.item.album.images[0].url}+''}" src="https://mdbootstrap.com//img/Photos/Others/blossom.jpg" alt="">
                        <div class="dot"></div>
                    </div>
                    <div class="col-8 icons text-center px-0" style="position: absolute; left: 58%; transform: translate(-50%); ">
                        <i class="fas fa-backward fa-2x p-md-4 p-3 my-2"></i>
                        <i id="pButton" class="fas fa-play fa-2x p-md-4 p-3 my-2"></i>
                        <i class="fas fa-forward fa-2x p-md-4 p-3 my-2"></i>
                    </div>
                </div>
            </div>

        </div>

    </div></div>




    <!-- jQuery -->
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="js/mdb.min.js"></script>
    <!-- Your custom scripts (optional) -->
    <script type="text/javascript">
        var music = document.getElementById('music'); // id for audio element
        var duration = music.duration; // Duration of audio clip, calculated here for embedding purposes
        var pButton = document.getElementById('pButton'); // play button
        var playhead = document.getElementById('playhead'); // playhead
        var timeline = document.getElementById('timeline'); // timeline
        var image = document.getElementById('image'); // timeline

        // timeline width adjusted for playhead
        var timelineWidth = timeline.offsetWidth - playhead.offsetWidth;

        // play button event listenter
        pButton.addEventListener("click", play);

        // timeupdate event listener
        music.addEventListener("timeupdate", timeUpdate, false);

        // makes timeline clickable
        timeline.addEventListener("click", function(event) {
            moveplayhead(event);
            music.currentTime = duration * clickPercent(event);
        }, false);

        // returns click as decimal (.77) of the total timelineWidth
        function clickPercent(event) {
            return (event.clientX - getPosition(timeline)) / timelineWidth;
        }

        // makes playhead draggable
        playhead.addEventListener('mousedown', mouseDown, false);
        window.addEventListener('mouseup', mouseUp, false);

        // Boolean value so that audio position is updated only when the playhead is released
        var onplayhead = false;

        // mouseDown EventListener
        function mouseDown() {
            onplayhead = true;
            window.addEventListener('mousemove', moveplayhead, true);
            music.removeEventListener('timeupdate', timeUpdate, false);
        }

        // mouseUp EventListener
        // getting input from all mouse clicks
        function mouseUp(event) {
            if (onplayhead == true) {
                moveplayhead(event);
                window.removeEventListener('mousemove', moveplayhead, true);
                // change current time
                music.currentTime = duration * clickPercent(event);
                music.addEventListener('timeupdate', timeUpdate, false);
            }
            onplayhead = false;
        }
        // mousemove EventListener
        // Moves playhead as user drags
        function moveplayhead(event) {
            var newMargLeft = event.clientX - getPosition(timeline);

            if (newMargLeft >= 0 && newMargLeft <= timelineWidth) {
                playhead.style.marginLeft = newMargLeft + "px";
            }
            if (newMargLeft < 0) {
                playhead.style.marginLeft = "0px";
            }
            if (newMargLeft > timelineWidth) {
                playhead.style.marginLeft = timelineWidth + "px";
            }
        }

        // timeUpdate
        // Synchronizes playhead position with current point in audio
        function timeUpdate() {
            var playPercent = timelineWidth * (music.currentTime / duration);
            playhead.style.marginLeft = playPercent + "px";
            // timeline.style.backgroundColor = '#9c27b0';
            if (music.currentTime == duration) {
                pButton.className = "";
                pButton.className = "fas fa-play fa-2x p-md-4 p-3 my-2";
            }
        }

        //Play and Pause
        function play() {
            // start music
            if (music.paused) {
                music.play();
                // remove play, add pause
                pButton.className = "";
                pButton.className = "fas fa-pause fa-2x p-md-4 p-3 my-2";
                image.classList.add('spin-animation');
            } else { // pause music
                music.pause();
                // remove pause, add play
                pButton.className = "";
                pButton.className = "fas fa-play fa-2x p-md-4 p-3 my-2";
                image.classList.remove('spin-animation');
            }
        }

        // Gets audio file duration
        music.addEventListener("canplaythrough", function() {
            duration = music.duration;
        }, false);

        // getPosition
        // Returns elements left position relative to top-left of viewport
        function getPosition(el) {
            return el.getBoundingClientRect().left;
        }

        //changing padding of navbar on scroll
        $(window).scroll(function() {
            let position = $(this).scrollTop();
            if (position >= 100) {
                $('.navbar').addClass('custom-navigation-bar');
            } else {
                $('.navbar').removeClass('custom-navigation-bar');
            }
        });

    </script>

</body>

</html>
